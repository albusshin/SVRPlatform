package com.SVRPlatform.action;

import java.util.List;

import javax.servlet.http.HttpServletRequest;
import org.apache.struts2.interceptor.ServletRequestAware;
import com.SVRPlatform.Utils.VerifyUser;
import com.SVRPlatform.constants.Constants;
import com.SVRPlatform.data.ExploitData;
import com.SVRPlatform.data.VulnerabilityExploitsData;
import com.SVRPlatform.service.ExploitsDisplayService;
import com.opensymphony.xwork2.ActionSupport;

public class DisplayVulnerabilityExploits extends ActionSupport implements
		ServletRequestAware {
	private static final long serialVersionUID = 1L;
	private HttpServletRequest request;
	private ExploitsDisplayService exploitsDisplayService;
	private String strVulnerabilityNumber;
	private String strExploitsAmount;
	private String strNowPage;
	private String strStat;
	private boolean isAlreadyGiven;
	private String strIsAlreadyGiven;
	private List<ExploitData> exploitsData;
	
	public ExploitsDisplayService getExploitsDisplayService() {
		return exploitsDisplayService;
	}

	public void setExploitsDisplayService(
			ExploitsDisplayService exploitsDisplayService) {
		this.exploitsDisplayService = exploitsDisplayService;
	}

	public String getStrVulnerabilityNumber() {
		return strVulnerabilityNumber;
	}

	public void setStrVulnerabilityNumber(String strVulnerabilityNumber) {
		this.strVulnerabilityNumber = strVulnerabilityNumber;
	}

	public String getStrExploitsAmount() {
		return strExploitsAmount;
	}

	public void setStrExploitsAmount(String strExploitsAmount) {
		this.strExploitsAmount = strExploitsAmount;
	}

	public String getStrNowPage() {
		return strNowPage;
	}

	public void setStrNowPage(String strNowPage) {
		this.strNowPage = strNowPage;
	}

	public String getStrStat() {
		return strStat;
	}

	public void setStrStat(String strStat) {
		this.strStat = strStat;
	}

	public boolean isAlreadyGiven() {
		return isAlreadyGiven;
	}

	public void setAlreadyGiven(boolean isAlreadyGiven) {
		this.isAlreadyGiven = isAlreadyGiven;
	}

	public String getStrIsAlreadyGiven() {
		return strIsAlreadyGiven;
	}

	public void setStrIsAlreadyGiven(String strIsAlreadyGiven) {
		this.strIsAlreadyGiven = strIsAlreadyGiven;
	}

	public List<ExploitData> getExploitsData() {
		return exploitsData;
	}

	public void setExploitsData(List<ExploitData> exploitsData) {
		this.exploitsData = exploitsData;
	}

	public void setServletRequest(HttpServletRequest request) {
		this.request = request;
	}

	public String execute() {
		int nowPage = Integer.parseInt(strNowPage);
		if (nowPage < 1)
			return "error";
		int userID = VerifyUser.getNowUserID(request);

		VulnerabilityExploitsData theData = exploitsDisplayService.exploitsDisplayService(userID, strVulnerabilityNumber, nowPage, 5);
		exploitsData = theData.getExploitsData();
		strExploitsAmount = theData.getExploitCount() + "";
		isAlreadyGiven = exploitsDisplayService.ifAlreadyGiven(userID,	strVulnerabilityNumber);
		if (isAlreadyGiven) {
			strIsAlreadyGiven = "true";
		} else {
			strIsAlreadyGiven = "false";
		}
		
		if (request.getAttribute("message") == null)
			request.setAttribute("message", null);

		return Constants.SUCCESS;
	}
}
