package com.SVRPlatform.action;

import java.io.ByteArrayInputStream;
import java.io.InputStream;
import java.util.Map;

import javax.servlet.http.HttpServletRequest;

import org.apache.struts2.interceptor.ServletRequestAware;

import com.SVRPlatform.Utils.VerifyUser;
import com.SVRPlatform.constants.Constants;
import com.SVRPlatform.data.ExploitCommentsData;
import com.SVRPlatform.service.ExploitCommentDisplayService;
import com.SVRPlatform.service.ExploitCommentSubmitService;
import com.opensymphony.xwork2.ActionSupport;

public class ExploitComment extends ActionSupport implements ServletRequestAware{
	
	/**
	 * 
	 */
	private static final long serialVersionUID = 1L;

	//service
		private ExploitCommentSubmitService exploitCommentSubmitService;
		private ExploitCommentDisplayService exploitCommentDisplayService;
		//data
		private ExploitCommentsData exploitCommentsData;
		private String email;
		private int exploitId;
		private String content;
		//for ajax return
		InputStream inputStream;
		

		//getters and setters
		public InputStream getInputStream() {
			return inputStream;
		}
		public String getContent() {
			return content;
		}
		public void setContent(String content) {
			this.content = content;
		}
		public ExploitCommentSubmitService getExploitCommentSubmitService() {
			return exploitCommentSubmitService;
		}
		public void setExploitCommentSubmitService(
				ExploitCommentSubmitService exploitCommentSubmitService) {
			this.exploitCommentSubmitService = exploitCommentSubmitService;
		}
		public ExploitCommentDisplayService getExploitCommentDisplayService() {
			return exploitCommentDisplayService;
		}
		public void setExploitCommentDisplayService(
				ExploitCommentDisplayService exploitCommentDisplayService) {
			this.exploitCommentDisplayService = exploitCommentDisplayService;
		}
		public ExploitCommentsData getExploitCommentsData() {
			return exploitCommentsData;
		}
		public void setExploitCommentsData(ExploitCommentsData exploitCommentsData) {
			this.exploitCommentsData = exploitCommentsData;
		}
		public String getEmail() {
			return email;
		}
		public void setEmail(String email) {
			this.email = email;
		}
		public int getExploitId() {
			return exploitId;
		}
		public void setExploitId(int exploitId) {
			this.exploitId = exploitId;
		}
		//functions to be executed
		public String displayExploitComments(){
			this.exploitCommentsData = 
			this.exploitCommentDisplayService.commentsDispalyService(exploitId, 0, 0);
			return Constants.SUCCESS;
		}
		
		public String submitExploitComment(){
			Map<String, String> map = this.exploitCommentSubmitService.commentSubmit(exploitId, email, content);
			if(map.get("status").equals("success"))
				inputStream = new ByteArrayInputStream(Constants.SUCCESS.getBytes());
			else
				inputStream = new ByteArrayInputStream(Constants.FAIL.getBytes());
			return "submit";
		}
		@Override
		public void setServletRequest(HttpServletRequest request) {
			this.email = VerifyUser.getNowUser(request);
		}

}
