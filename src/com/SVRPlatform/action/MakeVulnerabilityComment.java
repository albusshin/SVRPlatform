package com.SVRPlatform.action;

import java.util.Map;

import javax.servlet.http.HttpServletRequest;

import org.apache.struts2.interceptor.ServletRequestAware;

import com.SVRPlatform.Utils.VerifyUser;
import com.SVRPlatform.constants.Constants;
import com.SVRPlatform.service.VulnerabilityCommentSubmitService;
import com.opensymphony.xwork2.ActionSupport;

public class MakeVulnerabilityComment extends ActionSupport implements
		ServletRequestAware {
	private static final long serialVersionUID = -6477916272654433913L;
	private String strVulnerabilityNumber;
	private String strNowPage;
	private String commentssubmittext;
	private String commentssubmittitle;
	private String message;
	private String strStat;
	private VulnerabilityCommentSubmitService vulnerabilityCommentSubmitService;
	private HttpServletRequest request;

	public void setServletRequest(HttpServletRequest request) {
		this.request = request;
	}
	
	public String getStrVulnerabilityNumber() {
		return strVulnerabilityNumber;
	}

	public void setStrVulnerabilityNumber(String strVulnerabilityNumber) {
		this.strVulnerabilityNumber = strVulnerabilityNumber;
	}

	public String getStrNowPage() {
		return strNowPage;
	}

	public void setStrNowPage(String strNowPage) {
		this.strNowPage = strNowPage;
	}

	public String getCommentssubmittext() {
		return commentssubmittext;
	}

	public void setCommentssubmittext(String commentssubmittext) {
		this.commentssubmittext = commentssubmittext;
	}

	public String getCommentssubmittitle() {
		return commentssubmittitle;
	}

	public void setCommentssubmittitle(String commentssubmittitle) {
		this.commentssubmittitle = commentssubmittitle;
	}

	public String getMessage() {
		return message;
	}

	public void setMessage(String message) {
		this.message = message;
	}

	public String getStrStat() {
		return strStat;
	}

	public void setStrStat(String strStat) {
		this.strStat = strStat;
	}

	public VulnerabilityCommentSubmitService getVulnerabilityCommentSubmitService() {
		return vulnerabilityCommentSubmitService;
	}

	public void setVulnerabilityCommentSubmitService(
			VulnerabilityCommentSubmitService vulnerabilityCommentSubmitService) {
		this.vulnerabilityCommentSubmitService = vulnerabilityCommentSubmitService;
	}


	public String execute() {
		String nowUser = VerifyUser.getNowUser(request);
		if (nowUser == null) {
			return Constants.NOTSIGNEDIN;
		}
		strNowPage = "1";
		String email = (String) request.getSession().getAttribute("email");
		Map<String, String> map = vulnerabilityCommentSubmitService.commentSubmit(
				strVulnerabilityNumber, email, commentssubmittitle, commentssubmittext);
		if (map.get("status").equals("fail")) {
			message = "There's something wrong with your inputs, please check:\n";
			if ((!map.get("title").equals("OK"))) {
				message += "Please input the digest of the comment. ";
			}
			if (!(map.get("content").equals("OK"))) {
				message += "Please input your description about the comment. ";
			}
			strStat = "wrong";
			return Constants.FAIL;
		} else {
			return Constants.SUCCESS;
		}
	}
}
