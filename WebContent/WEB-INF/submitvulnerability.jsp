<%@ page language="java" contentType="text/html;  charset=utf-8"
    pageEncoding="utf-8"%>
<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Submit New VULNERABILITY Information - SVRPlatform</title>
	<link rel="stylesheet" href="style.css" />
	<script type="text/javascript" src="jquery.min.js"></script>
</head>

<body>


	<%
	
	String str = (String) session.getAttribute("email");
	if (str != null){
		str = "signedin";
	}
	
	%>
 		<jsp:include page="header.jsp" flush="true">
 			<jsp:param name="type" value="<%=str%>"/>
 		</jsp:include>
 
 	<div id="wrongmessage1" class="alert-messages" style="display:none">
 		<div class="message">
	 		<div class="message-inside">
		 		<div class="message-text">
			 		<div>
				 			${message }
				 	</div>
		 		</div>
		 		<a class="dismiss" href="javascript:dismiss();">×</a>
	 		</div>
 		</div>
 	</div>
 	<%
 		String stat = request.getParameter("stat");
 		System.out.println("stat == " + request.getParameter("stat"));
 		if (stat != null)
	 		if (stat.equals("wrong")){
	 			out.println("<div id=\"wrongmessage\" class=\"alert-messages\" style=\"display:block\">");
	 			out.println("<div class=\"message\">");
	 			out.println("<div class=\"message-inside\">");
	 			out.println("<div class=\"message-text\">");
	%>
		<div>
	 			${message }
	 	</div>
	<%
	 			out.println("</div>");
	 			out.println("<a class=\"dismiss\" href=\"javascript:dismiss();\">×</a>");
	 			out.println("</div>");
	 			out.println("</div>");
	 			out.println("</div>");
	 		}
 	%>
             	<script type="text/javascript">
             		function dismiss(){
             			document.getElementById("wrongmessage").setAttribute("style", "display:none");
             		}
             	</script>
    <div id="content">
	<div class="commentstitle" style="padding-top:30px;">
		Submit New Vulnerability Information
	</div>
	<style type="text/css">
	label#Score{
		margin-left:100px;
		padding-left:150px;
		padding-right:150px;
		background:#ff6600;
		font-size:40px;
	}
	</style>
    	<form id="submitbug" action="submitvulnerability" method="post">
        	<div class="submitbugdigest">
            	<table class="submitbugtable">
                <tr>
                	<td class="submitbugkey">
                    	<label for="digest" > Digest </label>
                    </td>
                    <td class="submitbugvalue">
                    	<textarea id="digest" name="digest" maxlength="300" tabindex="100" class="inputdigestvalue" placeholder="Vulnerability digest should include software name, version and stuff."></textarea>
                    </td>
	    </tr>
	    <tr>
		    <td class="submitbugkey">
			    <label for="Score"> SVRV Score </label>
		    </td>
		    <td class="submitbugvalue">
			    <input type="number" name="score"/>
		    </td>
	    </tr>
	    <tr>
		    <td class="submitbugkey">
			    <label for="confidentialityImpact"> Confidentiality Impact </label>
		    </td>
		    <td class="submitbugvalue">
			<select name="confidentialityImpact">
 				 <option value ="Complete">Complete</option>
				 <option value ="Partial" selected="selected">Partial</option>
				 <option value="Little">Little</option>
 				 <option value="None">None</option>
			</select>   
		    </td>
	    </tr>
	    <tr>
		    <td class="submitbugkey">
			    <label for="integrityImpact"> Integrity Impact </label>
		    </td>
		    <td class="submitbugvalue">
			<select name="integrityImpact">
 				 <option value ="Complete">Complete</option>
				 <option value ="Partial" selected="selected">Partial</option>
				 <option value="Little">Little</option>
 				 <option value="None">None</option>
			</select>  
		    </td>
	    </tr>
	    <tr>
		    <td class="submitbugkey">
			    <label for="availabilityImpact"> Availability Impact </label>
		    </td>
		    <td class="submitbugvalue">
			<select name="availabilityImpact">
 				 <option value ="Complete">Complete</option>
				 <option value ="Partial" selected="selected">Partial</option>
				 <option value="Little">Little</option>
 				 <option value="None">None</option>
			</select>  
		    </td>
	    </tr>
	    <tr>
		    <td class="submitbugkey">
			    <label for="accessComplexity"> Access Complexity </label>
		    </td>
		    <td class="submitbugvalue">
			<select name="accessComplexity">
 				 <option value ="Low">Low</option>
				 <option value ="Medium" selected="selected">Medium </option>
				 <option value="High">High</option>
			</select>  
		    </td>
	    </tr>
	    <tr>
		    <td class="submitbugkey">
			    <label for="authentication"> Authentication </label>
		    </td>
		    <td class="submitbugvalue">
			<select name="authentication">
 				 <option value ="NotRequired">Not Required</option>
				 <option value ="Required" selected="selected">Required </option>
			</select>  
		    </td>
	    </tr>
	    <tr>
		    <td class="submitbugkey">
			    <label for="gainedAccess"> Gained Access </label>
		    </td>
		    <td class="submitbugvalue">
			<select name="gainedAccess">
 				 <option value ="None">None</option>
				 <option value ="Medium" selected="selected">Medium </option>
				 <option value="High">High</option>
			</select>  
		    </td>
	    </tr>
	    <tr>
		    <td class="submitbugkey">
			    <label for="vulnerabilityType"> Vulnerability Type </label>
		    </td>
		    <td class="submitbugvalue">
			<select name="vulnerabilityType">
 				 <option value ="ExecuteCode">Execute Code</option>
				 <option value ="DenialOfService" selected="selected">Denial Of Service </option>
				 <option value ="GainPrivileges">Gain privileges</option>
			</select>  
		    </td>
	    </tr>
                <tr>
                	<td class="submitbugkey">
                    	<label for="description"> Description </label>
                    </td>
                    <td class="submitbugvalue">
                    	<textarea id="description" name="description" maxlength="300" tabindex="100" class="inputdigestvalue" placeholder="Bug description should be very specific about the bug itself, including software versions, software company, platform of running the software, and so on."></textarea>
                    </td>
                </tr>

		<%-- 
			1. url in ajax needs to be modified.
        	2. upload page should print out the image address
        --%>
		<tr>
			<td class="submitbugkey">
				<label for="Screenshot"> Screenshot </label>
			</td>
			<td class="submitugvalue">
				<script type="text/javascript">					
					$(document).ready(function(){
					     $("#inputfile").change(function(){
							 $("#uploadscreenshotbutton").attr('style','display:none');
					         //create FormData
					         var data = new FormData();
					         
					         //add data for FormData
					         data.append('graph',$("#inputfile")[0].files[0]);
					         $.ajax({
					             url:'uploadgraph',
					             type:'POST',
					             data:data,
					             cache: false,
					             enctype: 'multipart/form-data',
					             contentType: false,    //must declare
					             processData: false,    //must declare
					             success:function(data){
					                 $("#uploadscreenshot").attr("src",data);
					                 $("#uploadscreenshot").attr('style','display:block');
					                 $("#hiddenpath").attr('value', data);
					             },
					             error:function(){
					            	 $("#wrongmessage1").attr('style','display:block');
					             }					             
					         });
					     });
					 });
				</script>
				<img id="uploadscreenshotbutton" type='image' src="images/uploadbutton.png" width="300px" onmouseover="this.src='images/uploadbuttonpressed.png'" onmouseout="this.src='images/uploadbutton.png'" onclick="getElementById('inputfile').click()"/>
				<input id="hiddenpath" type="text" name="graphPath" style="display:none"/>
				
				<img id="uploadscreenshot" name="graphaddress" src="/"/>
			</td>
		</tr>
		
		<tr>
			<td class="submitbugkey">
				<label for="Software"> Software </label>
			</td>
			<td class="submitbugvalue">
				<textarea id="software" name="software" maxlength="100" tabindex="100" class="inputdigestvalue" placeholder="Input the name of the buggy software"></textarea>
			</td>
		</tr>	
		<tr>
			<td class="submitbugkey">
				<label for="Version"> Version </label>
			</td>
			<td class="submitbugvalue">
				<textarea id="version" name="version" maxlength="100" tabindex="100" class="inputdigestvalue" placeholder="Input the version of the buggy software"></textarea>
			</td>
		</tr>
		<tr>
			<td class="submitbugkey">
				<label for="Language"> Language </label>
			</td>
			<td class="submitbugvalue">
				<textarea id="language" name="language" maxlength="100" tabindex="100" class="inputdigestvalue" placeholder="Input the language of the software"></textarea>
			</td>
		</tr>
		<tr>
			<td>
				&nbsp;
			</td>
			<td>
				<input type="image" alt="submit" id="submitbutton" src="images/submitbutton.png" style="padding-left:400px; padding-top:50px; width:300px" onMouseOver="this.src='images/submitbuttonpressed.png'" onMouseOut="this.src='images/submitbutton.png'">
			</td>
		</tr>
                </table>
                
            </div>
	    
        </form>
      	<input type="file" name="graph" style="visibility:hidden" id="inputfile"/>
    </div>   
    
 		<jsp:include page="/footer.jsp" flush="true"/>
</body>
</html>
